import os
import hashlib
from typing import Iterable

from rpc_wrap import RpcApp

app = RpcApp("sfdl-sample-pyodide")


@app.call(name='process_one')
def process_one():
    return {"val": "Response from Process One"}


@app.call
def process_two():
    return {"val": "Response from Process Two"}

@app.call
def upload(file):
    data = '[{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"1","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"115356"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"135717"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"147980"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"194633"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"197474"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"232161"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"2431"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"244935"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"245118"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"250009"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"288369"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"289080"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"300367"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"308457"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"354455"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"363625"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"378727"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"419002"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"420627"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"422644"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"438490"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"483691"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"500229"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"508004"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"516400"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"518085"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"549531"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"560048"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"574154"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"58648"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"591172"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"652288"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"657425"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"659560"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"721241"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"725957"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"727783"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"733974"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"760316"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"79078"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"800819"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"806933"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"833390"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"842472"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"843267"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"863149"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"864948"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"868758"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"87520"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"87702"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"880820"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"934440"},{"Index":1289,"DOB":"22/04/2002","SDQ_SCORE":null,"SDQ_REASON":"SDQ3","CONVICTED":"0","HEALTH_CHECK":"0","IMMUNISATIONS":"0","TEETH_CHECK":"0","HEALTH_ASSESSMENT":"1","SUBSTANCE_MISUSE":"0","INTERVENTION_RECEIVED":"0","INTERVENTION_OFFERED":"0","errors":2,"code":"969789"}]'
    output = '{"oc2":' + data + ',"oc3":' + data + '}'
    return {"val": output}

@app.call
def listfiles(path: str = ".") -> Iterable[str]:
    filesystem = {}
    for root, dirs, files in os.walk(path):
        path_elements = root.split(os.sep)
        current = filesystem
        for element in path_elements:
            current = current.setdefault(element, {})

        for d in dirs:
            current[d] = {}
        for f in files:
            current[f] = dict(size=os.path.getsize(os.path.join(root, f)))

    return filesystem


@app.call
def checksum(algorithm: str = "sha256", single_file=None, multi_file=None):
    files = []
    if single_file:
        files.append(single_file)
    if multi_file:
        files.extend(multi_file)

    if not files:
        return "No files provided"

    print("Received the following files:")
    for f in files:
        print(f"  {f}")

    if algorithm not in hashlib.algorithms_available:
        return f"Algorithm {algorithm} not available"

    return_value = {}
    for file in files:
        hasher = hashlib.new(algorithm)
        hasher.update(file.read())
        return_value[file.filename] = hasher.hexdigest()
    return return_value